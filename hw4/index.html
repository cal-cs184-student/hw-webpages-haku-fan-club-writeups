<html>
	<head>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=default'></script>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
		<style>
			h1 {
				text-align: center;
			}

			.container {
				margin: 0 auto;
				padding: 60px 20%;
			}

			figure {
				text-align: center;
			}

			img {
				display: inline-block;
			}

			body {
				font-family: 'Inter', sans-serif;
			}
		</style>
	</head>
	<body>
		<div class="container">
		<h1>CS184/284A Spring 2025 Homework 4 Write-Up</h1>
		<div style="text-align: center;">Names: Crystal Chen, Jessica He</div>

		<br>

		Link to webpage: <a href="https://cal-cs184-student.github.io/hw-webpages-haku-fan-club-writeups/hw4/index.html">https://cal-cs184-student.github.io/hw-webpages-haku-fan-club-writeups/hw4/index.html</a>

		<br>

		Link to GitHub repository: <a href="https://github.com/cal-cs184-student/sp25-hw4-haku-fan-club-4">https://github.com/cal-cs184-student/sp25-hw4-haku-fan-club-4</a>

		<figure>
			<img src="clothsim.png" alt="Cloth draped over sphere" style="width:70%"/>
			<figcaption>You can add images with captions!</figcaption>
		</figure>

		<!--
		We've already added one heading per part, to make your write-up as navigable when grading. Please fit your write-up within these sections!
		-->

		<h2>Overview (TODO)</h2>
		Give a high-level overview of what you implemented in this homework. Think about what you've built as a whole. Share your thoughts on what interesting things you've learned from completing the homework.

		<h2>Part 1: Masses and springs</h2>
		<p>Here are some different viewing angles of the cloth wireframe, so you can clearly see the structure of our point masses and springs in <code>scene/pinned2.json</code></p>

		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="q1ai.png" width="400px"/>
				  <figcaption>Bird's eye view of the grid (from the top).</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="q1aii.png" width="400px"/>
				  <figcaption>View of grid from the side.</figcaption>
				</td>
				<td style="text-align: center;">
					<img src="q1aiii.png" width="400px"/>
					<figcaption>View of grid from the "bottom".</figcaption>
				</td>
			  </tr>
			</table>
		</div>

		<p>Here is what the wiring frame looks like with these modifications on spring constraints:</p>
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="q1bi.png" width="400px"/>
				  <figcaption>Wireframe without shearing constraints</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="q1bii.png" width="400px"/>
				  <figcaption>Wireframe with only the shearing constraints</figcaption>
				</td>
				<td style="text-align: center;">
					<img src="q1biii.png" width="400px"/>
					<figcaption>Wireframe with all constraints</figcaption>
				</td>
			  </tr>
			</table>
		</div>

		<p>Here is an example 2x2 gridlike structure using an HTML table. Each <b>tr</b> is a row and each <b>td</b> is a column in that row. You might find this useful for framing and showing your result images in an organized fashion.</p>
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="clothsim.png" width="400px"/>
				  <figcaption>Caption goes here.</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="clothsim.png" width="400px"/>
				  <figcaption>Caption goes here.</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="clothsim.png" width="400px"/>
				  <figcaption>Caption goes here.</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="clothsim.png" width="400px"/>
				  <figcaption>Caption goes here.</figcaption>
				</td>
			  </tr>
			</table>
		</div>

		<h2>Part 2: Simulation via numerical integration</h2>
		In this part, we integrated the physical equations of motion to apply the forces on the cloth's point masses, analyzing how different variables 
		affect the cloth's behavior and appearance.
		<br><br>
		\(k_s\): \(k_s\) is the spring constant, and as we increase this value, the cloth becomes less elastic and bouncy. For a low \(k_s\) value, the cloth 
		bounces up and down a lot before settling into the resting state, as the springs aren't as powerful in pulling the cloth to its rest position. In the final 
		resting state, the cloth droops down between the pinned corners with more visible wrinkles, as shown in the image below. On the other hand, for a high \(k_s\) 
		value, the cloth stretches much less and settles into the resting state much more quickly. In its final resting state, the cloth is more rigid with minimal stretching 
		or folding. The resting states for different \(k_s\) values are shown below:
		<br><br>

		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="p2-ks-small.png" width="300px"/>
				  <figcaption>\(k_s = 50\)</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="p2-ks-regular.png" width="300px"/>
				  <figcaption>\(k_s = 5000\)</figcaption>
				</td>
				<td style="text-align: center;">
					<img src="p2-ks-large.png" width="300px"/>
					<figcaption>\(k_s = 50000\)</figcaption>
				  </td>
			  </tr>
			</table>
		</div>


		<br><br>

		density: The density of the cloth is equal to mass / volume. Since volume remains the same, the higher the density of the cloth is, the higher the mass is. 
		Thus, for low densities, the cloth is very lightweight, and when it falls, it bounces more and takes longer to reach its final state. In the final resting state, 
		the cloth appears less stretched out and doesn't droop down very much between the pinned corners. On the other hand, for high densities, the cloth has more mass, 
		and this causes it to act more rigidly, bouncing much less and quickly reaching its final state. In the final resting state, the cloth droops down much more and appears more 
		wrinkly with deeper folds, which intuitively makes sense if the cloth is heavier. The resting states for different density values are shown below:
		<br><br>

		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="p2-density-small.png" width="300px"/>
				  <figcaption>density = 2</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="p2-density-regular.png" width="300px"/>
				  <figcaption>density = 15</figcaption>
				</td>
				<td style="text-align: center;">
					<img src="p2-density-large.png" width="300px"/>
					<figcaption>density = 50</figcaption>
				  </td>
			  </tr>
			</table>
		</div>

		<br><br>
		damping: Damping controls the amount of energy lost at every time step. With a low damping factor, the cloth bounces and oscillates back and forth a lot. It initally falls much more quickly 
		but takes longer to reach the final resting state. Also, the cloth is much more wrinkly as it oscillates when it is dropped. On the other hand, with a high damping factor, 
		the cloth falls at a slower rate and barely oscillates, but it reaches the final resting state quicker because it doesn't really bounce. The cloth appears very rigid and has very few wrinkles. The cloth at 2 
		different positions (not resting state) with a high and low damping factor are shown below: 
		<br><br>

		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="p2-damping-small.png" width="200px"/>
				  <figcaption>position 1, damping ≈ 0.01</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="p2-damping-large.png" width="200px"/>
				  <figcaption>position 1, damping ≈ 0.94</figcaption>
				</td>
				<td style="text-align: center;">
					<img src="p2-damping-small2.png" width="200px"/>
					<figcaption>position 2, damping ≈ 0.01</figcaption>
				</td>
				<td style="text-align: center;">
					<img src="p2-damping-large2.png" width="200px"/>
					<figcaption>position 2, damping ≈ 0.94</figcaption>
				</td>
			  </tr>
			</table>
		</div>

		<br><br>

		Finally, here is the shaded cloth from <code>scene/pinned4.json</code> in its final resting state (default parameters):
		<figure>
			<img src="p2-cloth.png" alt="Shaded cloth" style="width:70%"/>
			<figcaption>Shaded cloth: the 4 corners are pinned as the rest of the cloth falls down into a resting state</figcaption>
		</figure>


		<h2>Part 3: Handling collisions with other objects</h2>

		<p>Here, were our main steps in how we implemented handling collisions:</p>
		<ol>
			<li>First, check if we actually need to handle the collision. 
				<p>
					In other words, if the point mass was actually inside the plane or sphere. For the plane, we check this based on if the point has crossed the plane. Mathematically we compute the signed distances (which we can obtain from the dot product between the vector from any point from the plane to the point mass, and the plane’s normal) of the last position and current position of the point. Different signs indicate the point being on different sides of the plane, thus the point is “inside” the plane if the signs of the two signed distances are different. To check if the point is inside the sphere, we just take the difference vector between the point’s position and the origin of the sphere. If the length of this distance vector is less then the sphere’s radius, the point must be inside the sphere!
				</p>
			</li>
			<li>Second, if there is a collision, then we need to compute what change in position to the point is necessary to resolve the collision.
				<p> We resolve it by bumping up the “point mass” such that it lies on the surface of the plane/sphere. We take this as our “correction vector”.
					For the sphere, the correction vector is the difference vector between the point’s position and the sphere’s origin. The problem is that the difference vector is too small, thus the point is inside the sphere. All we have to do is scale this difference vector until its length is that of the sphere’s radius. So we can obtain the correction vector by taking the difference vector (which points outward from the origin), and scale it by the sphere’s radius.
					For the plane, we first calculate the tangent point, which is the intersection of where the point mass would have hit the plane if we extended it in a straight line. We do this using a parametric line equation, solving for a scalar t that occurs when the point is exactly on the plane. This t can be used to find the actual intersection point, which is the tangent point. The correction vector points from the point’s last position to this tangent point. We then add a small surface offset to the correction vector, because we don’t actually want the point’s new position to end up on the plane surface, but instead just above it. However, this small offset needs to be added along the unit normal of the plane, and also depends on what side the point came from. Thus if the signed distance of the last position was positive, we add the surface offset to the correction vector in the direction of the unit normal because the point comes from above the plane. Likewise, subtracting the surface offset if the signed distance was negative.
				</p>
			</li>
			<li> Finally, we adjust the point mass’s position using the correction vector from earlier.  However, we must also account for friction.
				<p>
					So all this step is, is updating the point’s new position, to the point’s last position plus the correction vector scaled by (1-f), where f is the friction coefficient, since we want to scale it down by friction.
				</p>
			</li>
		</ol>


		<p>Screenshots of shaded cloth from <code>scene/sphere.json</code> in its final resting state on the sphere with different values of <code>ks</code>:</p>
		<P>When actually playing each animation of dropping the cloth, as we decrease the value of <code>ks</code>, the cloth seems to drape over the sphere much more like cloth, as in it softly drapes.
			However, as we increase <code>ks</code>, the cloth becomes much more rigid, and tends to maintain its shape regardless of the sphere. This can be seen in the screenshots below, where for example, when 
			<code>ks = 50000</code>, there is a noticeable difference in how it seems angled compared to <code>ks = 500</code>, which follows better the shape of the sphere it drapes around. When <code>ks = 5000</code>, 
			we witness its form being somewhere in between these two, with elements of both rigidity and droopiness.
		</P>
		
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="q3ai.png" width="400px"/>
				  <figcaption><code>ks = 5000</code> (default) </figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="q3aii.png" width="400px"/>
				  <figcaption><code>ks = 500</code></figcaption>
				</td>
				<td style="text-align: center;">
					<img src="q3aiii.png" width="400px"/>
					<figcaption><code>ks = 50000</code></figcaption>
				</td>
			  </tr>
			</table>
		</div>

		<p>Now a screenshot of our shaded cloth lying peacefully at rest on the plane:</p>
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="q3b.png" width="400px"/>
				  <figcaption>our cloth from <code>scene/plane.json</code>(default) </figcaption>
				</td>
			  </tr>
			</table>
		</div>


		Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

		<h2>Part 4: Handling self-collisions</h2>
		Here are screenshots of how the cloth behaves as it falls at 3 different timestamps:
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="p4-1.png" width="300px"/>
				  <figcaption>timestamp 1</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="p4-2.png" width="300px"/>
				  <figcaption>timestamp 2</figcaption>
				</td>
				<td style="text-align: center;">
					<img src="p4-3.png" width="300px"/>
					<figcaption>timestamp 3</figcaption>
				  </td>
			  </tr>
			</table>
		</div>

		<h2>Part 5: Shaders</h2>
		<p>TODO here is what a shader program is</p>

		<p>TODO here is what blinn shading model is:</p>
		<p>Here is how our Blinn-Phong shading model looks on <code>scene/sphere.json</code>:</p>
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="q5ai.png" width="400px"/>
				  <figcaption>only shading the ambient component</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="q5aii.png" width="400px"/>
				  <figcaption>only shading the diffuse component</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="q5aiii.png" width="400px"/>
				  <figcaption>only shading the specular component</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="q5aiv.png" width="400px"/>
				  <figcaption>using the entire Blinn-Phong model</figcaption>
				</td>
			  </tr>
			</table>
		</div>

		<p>Here are some different angles of how our texture mapping shader looks like with our own custom texture!</p>
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="q5bi.png" width="400px"/>
				  <figcaption><code> our custom texture on the cloth (bird's eye view) </figcaption>
				</td>
				<td style="text-align: center;">
					<img src="q5bii.png" width="400px"/>
					<figcaption> our custom texture before being dropped </figcaption>
				</td>
				<td style="text-align: center;">
					<img src="q5biii.png" width="400px"/>
					<figcaption> another angle of our custom texture </figcaption>
				</td>
			  </tr>
			</table>
		</div>


		<p>Here is how bump and displacement mapping looked like for <code>scene/sphere.json</code>, using the texture from <code>texture_3.png</code>:</p>
		<p>TODO C....dadsfdaj comparing ...</p>
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="q5ci.png" width="400px"/>
				  <figcaption>bump mapping on the sphere</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="q5cii.png" width="400px"/>
				  <figcaption>bump mapping on the cloth</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="q5ciii.png" width="400px"/>
				  <figcaption>displacement mapping on the sphere</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="q5civ.png" width="400px"/>
				  <figcaption>displacement mapping on the cloth</figcaption>
				</td>
			  </tr>
			</table>
		</div>

		<p>TODO C....dadsfdaj comparing ...</p>
		<p>TODO C....dadsfdaj comparing EVEN MORE ...</p>
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="q5ci-16.png" width="400px"/>
				  <figcaption>bump mapping with parameters <code>-o 16 a -16</code> on the sphere</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="q5ci-128.png" width="400px"/>
				  <figcaption>bump mapping with parameters <code>-o 128 a -128</code> on the sphere</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="q5cii-16.png" width="400px"/>
				  <figcaption>displacement mapping with parameters <code>-o 16 a -16</code> on the cloth</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="q5cii-128.png" width="400px"/>
				  <figcaption>displacement mapping with parameters <code>-o 128 a -128</code> on the cloth</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="q5ciii-16.png" width="400px"/>
				  <figcaption>displacement mapping with parameters <code>-o 16 a -16</code> on the sphere</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="q5ciii-128.png" width="400px"/>
				  <figcaption>displacement mapping with parameters <code>-o 128 a -128</code> on the sphere</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="q5civ-16.png" width="400px"/>
				  <figcaption>bump mapping with parameters <code>-o 16 a -16</code> on the cloth</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="q5civ-128.png" width="400px"/>
				  <figcaption>bump mapping with parameters <code>-o 128 a -128</code> on the cloth</figcaption>
				</td>
			  </tr>
			</table>
		</div>
		
		

		<p>Here is how our mirror shader looks:</p>
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="q5di.png" width="400px"/>
				  <figcaption>Mirror shader just on the sphere</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="q5dii.png" width="400px"/>
				  <figcaption>Mirror shader on the cloth on the sphere</figcaption>
				</td>
			  </tr>
			</table>
		</div>

		<h2>(Optional) Part 6: Extra Credit - Additional cloth simulation features!</h2>
		Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
		
		<h2>Additional Notes (please remove)</h2>
		<ul>
			<li>You can also add code if you'd like as so: <code>code code code</code></li>
			<li>If you'd like to add math equations, 
				<ul>
					<li>You can write inline equations like so: \( a^2 + b^2 = c^2 \)</li>
					<li>You can write display equations like so: \[ a^2 + b^2 = c^2 \]</li>
				</ul>
			</li>
		</ul>
		</div>
	</body>
</html>